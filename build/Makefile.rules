# -*- mode: makefile -*-
# Some general rules that can be used for building C files, etc.
#

DEPDIR := .deps
DEPFLAGS = -MT $@ -MMD -MP -MF $(DEPDIR)/$*.d

# Build C based object files.
%.o : %.c $(DEPDIR)/%.d | $(DEPDIR)
	@echo "  [CC]\t\t$@"
	@$(CC) $(DEPFLAGS) $(CFLAGS) $(INCLUDES) -c -o $@ $<

# Assemble object files.
%.o : %.S $(DEPDIR)/%.d | $(DEPDIR)
	@echo "  [AS]\t\t$@"
	@$(CC) $(DEPFLAGS) $(CFLAGS) $(INCLUDES) -c -o $@ $<

% : %.c $(OBJS)
	@echo "  [CC]\t\t$@"
	@$(CC) $(CFLAGS) -o $@ $(OBJS) $(LIBS)

# Link binary blobs; for free standing things.
%.bin : $(OBJS)
	@echo "  [LD]\t\t$@"
	@$(LD) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

$(DEPDIR):
	@mkdir -p $@

DEPFILES := $(OBJS:%.o=$(DEPDIR)/%.d)
$(DEPFILES):

include $(wildcard $(DEPFILES))
